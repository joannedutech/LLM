---
// Client-side TOC: scans rendered headings in the article
---

<nav id="toc" class="hidden max-w-3xl mx-auto px-4 sm:px-6 mb-8" aria-label="文章目錄">
  <details open class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-800/50">
    <summary class="font-bold text-heading cursor-pointer select-none" style="font-size: var(--aw-text-body);">
      目錄
    </summary>
    <ol id="toc-list" class="mt-3 space-y-1 text-sm text-muted list-none pl-0"></ol>
  </details>
</nav>

<script>
  function buildTOC() {
    const article = document.querySelector('article .prose');
    const tocNav = document.getElementById('toc');
    const tocList = document.getElementById('toc-list');
    if (!article || !tocNav || !tocList) return;

    const headings = article.querySelectorAll('h2, h3');
    if (headings.length < 3) return; // Only show TOC for articles with 3+ headings

    tocList.innerHTML = '';
    headings.forEach((heading, i) => {
      if (!heading.id) {
        heading.id = `heading-${i}`;
      }
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${heading.id}`;
      a.textContent = heading.textContent || '';
      a.className = 'hover:text-primary dark:hover:text-green-400 block py-0.5';
      if (heading.tagName === 'H3') {
        li.className = 'pl-4';
      }
      li.appendChild(a);
      tocList.appendChild(li);
    });

    tocNav.classList.remove('hidden');
  }

  buildTOC();
  document.addEventListener('astro:after-swap', buildTOC);
</script>
